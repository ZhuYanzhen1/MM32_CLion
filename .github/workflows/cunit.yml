name: Unit Test

on: [ push ]

env:
  BUILD_TYPE: Release

jobs:
  build:
    runs-on: ubuntu-20.04
    steps:
      - uses: actions/checkout@v2
        with:
          fetch-depth: 1
      - name: Configure Software
        run: |
          sudo apt-get update && sudo apt-get -y upgrade && sudo apt-get install -y gcc g++ automake autoconf libtool wget cmake
          wget https://udomain.dl.sourceforge.net/project/cunit/CUnit/2.1-3/CUnit-2.1-3.tar.bz2
      - name: Install CUnit
        run: |
          tar -jxvf CUnit-2.1-3.tar.bz2 && ls && cd CUnit-2.1-3
          ./bootstrap && ./configure --prefix /home/runner/work/MM32_CLion/MM32_CLion/cunit
          make && make install && cd /home/runner/work/MM32_CLion/MM32_CLion/cunit && sudo ldconfig
      - name: Run Test Program
        run: |
          ls && cd testbench && mkdir build && ls && cd build
          cmake -DCMAKE_BUILD_TYPE=Debug -DCMAKE_BUILD_PLATFORM=github ../ && make
          export LD_LIBRARY_PATH=/home/runner/work/MM32_CLion/MM32_CLion/cunit/lib
          ls && ./testbench
